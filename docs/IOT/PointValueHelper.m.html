<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>IoticAgent.IOT.PointValueHelper API documentation</title>
    <meta name="description" content="Shareable object helper classes" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #05B;
    text-decoration: none;
    font-weight: 500;
    border-bottom: 1px dashed #CCCCCC;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #E95420;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  }

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; }

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;

      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>


  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#IoticAgent.IOT.PointValueHelper.logger">logger</a></li>
  </ul>

    </li>


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#IoticAgent.IOT.PointValueHelper.PointDataObjectHandler">PointDataObjectHandler</a></span>
        
          
  <ul>
    <li class="mono"><a href="#IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.__init__">__init__</a></li>
    <li class="mono"><a href="#IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.get_template">get_template</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#IoticAgent.IOT.PointValueHelper.RefreshException">RefreshException</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#IoticAgent.IOT.PointValueHelper.Value">Value</a></span>
        
          
  <ul>
    <li class="mono"><a href="#IoticAgent.IOT.PointValueHelper.Value.__init__">__init__</a></li>
    <li class="mono"><a href="#IoticAgent.IOT.PointValueHelper.Value.copy">copy</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">IoticAgent.IOT.PointValueHelper</span> module</h1>
  <p>Shareable object helper classes</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper" class="source">
    <pre><code># Copyright (c) 2016 Iotic Labs Ltd. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://github.com/Iotic-Labs/py-IoticAgent/blob/master/LICENSE
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
"""Shareable object helper classes
"""

from __future__ import unicode_literals

from collections import namedtuple
import logging
logger = logging.getLogger(__name__)

from IoticAgent.Core.Validation import Validation
from IoticAgent.Core.compat import Sequence, Lock, valid_identifier

from .Exceptions import IOTUnknown
from .Point import Point, PointDataObject
from .RemotePoint import RemotePoint
from .utils import private_names_for


class Value(object):
    """Represent data and metadata for a single value. NOT thread safe."""

    __slots__ = tuple(private_names_for('Value', ('__label', '__type', '__unit', '__description', '__unset',
                                                  '__value')))

    def __init__(self, label, type_, unit=None, description=None):
        self.__label = label
        self.__type = type_
        self.__unit = unit
        self.__description = description
        self.__unset = True
        self.__value = None

    @property
    def unset(self):
        """Whether this value instances has had data assigned to it"""
        return self.__unset

    @property
    def label(self):
        """Label for this value"""
        return self.__label

    @property
    def type_(self):
        """Value type, e.g. one of IoticAgent.Datatypes"""
        return self.__type

    @property
    def unit(self):
        """Value unit, e.g. one of IoticAgent.Units"""
        return self.__unit

    @property
    def description(self):
        """Human-readable description of this value"""
        return self.__description

    @property
    def value(self):
        """Data for this value. Returns None if it hasn't been set. To distinguish between None and
        and unset, check the `unset` property."""
        return self.__value

    @value.setter
    def value(self, value):
        self.__unset = False
        self.__value = value

    @value.deleter
    def value(self):
        self.__unset = True
        self.__value = None

    def copy(self):
        return Value(self.__label, self.__type, self.__unit, self.__description)


class _ValueFilter(namedtuple('nt__ValueFilter', 'by_type by_unit')):
    """Used by PointDataObject to present a subset of values."""

    def __new__(cls, by_type, by_unit):
        return super(_ValueFilter, cls).__new__(cls,
                                                {name: frozenset(values) for name, values in by_type.items()},
                                                {name: frozenset(values) for name, values in by_unit.items()})

    def filter_by(self, types=(), units=()):
        """Return list of value labels, filtered by either or both type and unit. An empty
        sequence for either argument will match as long as the other argument matches any values."""
        if not (isinstance(types, Sequence) and isinstance(units, Sequence)):
            raise TypeError('types/units must be a sequence')
        empty = frozenset()

        if types:
            type_names = set()
            for type_ in types:
                type_names |= self.by_type.get(type_, empty)
            if not units:
                return type_names

        if units:
            unit_names = set()
            for unit in units:
                unit_names |= self.by_unit.get(unit, empty)
            if not types:
                return unit_names

        return (type_names & unit_names) if (types and units) else empty


class RefreshException(Exception):
    """Raised by __refresh() to indicate metadata unsuitable for template usage."""
    pass


class PointDataObjectHandler(object):
    """Caches metadata for a point and produces skeletal represenation of a point's values, optionally populating it
    with data from a share/ask/tell. Threadsafe."""

    __slots__ = tuple(private_names_for('PointDataObjectHandler', ('__remote', '__point', '__last_parse_ok', '__client',
                                                                   '__lock', '__value_templates', '__filter')))

    def __init__(self, point, client):
        """point - instance of Point, RemoteFeed or RemoteControl or a valid GUID
           client - instance of IOT.Client
        """
        # remote => use describe, non-remote => use point value listing
        if isinstance(point, Point):
            self.__remote = False
            self.__point = point
        elif isinstance(point, RemotePoint):
            self.__point = point.guid
            self.__remote = True
        else:
            self.__point = Validation.guid_check_convert(point)
            self.__remote = True

        self.__lock = Lock()
        self.__client = client
        # flag to prevent repeated fetching of value metadata
        self.__last_parse_ok = True
        self.__value_templates = None
        self.__filter = None

    def get_template(self, data=None):  # noqa (complexity)
        """Get new template which represents the values of this point in a
        [PointDataObject](./Point.m.html#IoticAgent.IOT.Point.PointDataObject). If data is set (to a dictionary), use
        this to populate the created template."""
        with self.__lock:
            if self.__value_templates is None and self.__last_parse_ok:
                try:
                    self.__refresh()
                except RefreshException:
                    # Point has no (useable) values - don't try to refetch again
                    self.__last_parse_ok = False
                    raise
            if self.__value_templates is None:
                raise ValueError('Point has no values')
            if data is None:
                template = PointDataObject(self.__value_templates, self.__filter)
            else:
                while True:
                    try:
                        template = PointDataObject._from_dict(self.__value_templates, self.__filter, data)
                    except:
                        # parsing has failed for first time since refresh so try again
                        if self.__last_parse_ok:
                            logger.debug('Failed to parse data from for point %s, refreshing', self.__point)
                            self.__last_parse_ok = False
                            try:
                                self.__refresh()
                            except RefreshException:
                                break
                        else:
                            raise
                    else:
                        self.__last_parse_ok = True
                        break
            return template

    def __refresh(self):
        """Update local knowledge of values (to be used to create new skeletal instances). MUST be called within
        lock."""
        raw_values = self.__get_values()
        if not raw_values:
            raise RefreshException('Point has no values')

        # individual templates
        templates = []
        # lookup tables by type and unit of value
        by_type = {}
        by_unit = {}

        for raw_value in raw_values:
            label = raw_value['label']
            if not valid_identifier(label) or label.startswith('__'):
                raise RefreshException('Value "%s" unsuitable for object wrapper' % label)
            value = Value(label, raw_value['type'], raw_value['unit'], raw_value['comment'])
            templates.append(value)
            try:
                by_type[value.type_].add(label)
            except KeyError:
                by_type[value.type_] = {label}
            if value.unit:
                try:
                    by_unit[value.unit].add(label)
                except KeyError:
                    by_unit[value.unit] = {label}

        self.__value_templates = templates
        self.__filter = _ValueFilter(by_type, by_unit)

    def __get_values(self):
        """Retrieve value information either via describe or point value listing. MUST be called within lock."""
        values = []

        if self.__remote:
            description = self.__client.describe(self.__point)
            if description is not None:
                if description['type'] != 'Point':
                    raise IOTUnknown('%s is not a Point' % self.__point)
                values = description['meta']['values']
        else:
            limit = 100
            offset = 0
            while True:
                new = self.__point.list(limit=limit, offset=offset)
                values += new
                if len(new) < limit:
                    break
                offset += limit

            # Unlike for describe, value comments are keyed by language here, so unwrap to have same layout as for
            # describe call (default language only, if available).
            lang = self.__client.default_lang
            for value in values:
                value['comment'] = value['comment'].get(lang, None) if value['comment'] else None

        return values
</code></pre>
  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="IoticAgent.IOT.PointValueHelper.logger" class="name">var <span class="ident">logger</span></p>
      
  
  <div class="source_cont">
</div>

      </div>


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="IoticAgent.IOT.PointValueHelper.PointDataObjectHandler" class="name">class <span class="ident">PointDataObjectHandler</span></p>
      
  
    <div class="desc"><p>Caches metadata for a point and produces skeletal represenation of a point's values, optionally populating it
with data from a share/ask/tell. Threadsafe.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper.PointDataObjectHandler', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper.PointDataObjectHandler" class="source">
    <pre><code>class PointDataObjectHandler(object):
    """Caches metadata for a point and produces skeletal represenation of a point's values, optionally populating it
    with data from a share/ask/tell. Threadsafe."""

    __slots__ = tuple(private_names_for('PointDataObjectHandler', ('__remote', '__point', '__last_parse_ok', '__client',
                                                                   '__lock', '__value_templates', '__filter')))

    def __init__(self, point, client):
        """point - instance of Point, RemoteFeed or RemoteControl or a valid GUID
           client - instance of IOT.Client
        """
        # remote => use describe, non-remote => use point value listing
        if isinstance(point, Point):
            self.__remote = False
            self.__point = point
        elif isinstance(point, RemotePoint):
            self.__point = point.guid
            self.__remote = True
        else:
            self.__point = Validation.guid_check_convert(point)
            self.__remote = True

        self.__lock = Lock()
        self.__client = client
        # flag to prevent repeated fetching of value metadata
        self.__last_parse_ok = True
        self.__value_templates = None
        self.__filter = None

    def get_template(self, data=None):  # noqa (complexity)
        """Get new template which represents the values of this point in a
        [PointDataObject](./Point.m.html#IoticAgent.IOT.Point.PointDataObject). If data is set (to a dictionary), use
        this to populate the created template."""
        with self.__lock:
            if self.__value_templates is None and self.__last_parse_ok:
                try:
                    self.__refresh()
                except RefreshException:
                    # Point has no (useable) values - don't try to refetch again
                    self.__last_parse_ok = False
                    raise
            if self.__value_templates is None:
                raise ValueError('Point has no values')
            if data is None:
                template = PointDataObject(self.__value_templates, self.__filter)
            else:
                while True:
                    try:
                        template = PointDataObject._from_dict(self.__value_templates, self.__filter, data)
                    except:
                        # parsing has failed for first time since refresh so try again
                        if self.__last_parse_ok:
                            logger.debug('Failed to parse data from for point %s, refreshing', self.__point)
                            self.__last_parse_ok = False
                            try:
                                self.__refresh()
                            except RefreshException:
                                break
                        else:
                            raise
                    else:
                        self.__last_parse_ok = True
                        break
            return template

    def __refresh(self):
        """Update local knowledge of values (to be used to create new skeletal instances). MUST be called within
        lock."""
        raw_values = self.__get_values()
        if not raw_values:
            raise RefreshException('Point has no values')

        # individual templates
        templates = []
        # lookup tables by type and unit of value
        by_type = {}
        by_unit = {}

        for raw_value in raw_values:
            label = raw_value['label']
            if not valid_identifier(label) or label.startswith('__'):
                raise RefreshException('Value "%s" unsuitable for object wrapper' % label)
            value = Value(label, raw_value['type'], raw_value['unit'], raw_value['comment'])
            templates.append(value)
            try:
                by_type[value.type_].add(label)
            except KeyError:
                by_type[value.type_] = {label}
            if value.unit:
                try:
                    by_unit[value.unit].add(label)
                except KeyError:
                    by_unit[value.unit] = {label}

        self.__value_templates = templates
        self.__filter = _ValueFilter(by_type, by_unit)

    def __get_values(self):
        """Retrieve value information either via describe or point value listing. MUST be called within lock."""
        values = []

        if self.__remote:
            description = self.__client.describe(self.__point)
            if description is not None:
                if description['type'] != 'Point':
                    raise IOTUnknown('%s is not a Point' % self.__point)
                values = description['meta']['values']
        else:
            limit = 100
            offset = 0
            while True:
                new = self.__point.list(limit=limit, offset=offset)
                values += new
                if len(new) < limit:
                    break
                offset += limit

            # Unlike for describe, value comments are keyed by language here, so unwrap to have same layout as for
            # describe call (default language only, if available).
            lang = self.__client.default_lang
            for value in values:
                value['comment'] = value['comment'].get(lang, None) if value['comment'] else None

        return values
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#IoticAgent.IOT.PointValueHelper.PointDataObjectHandler">PointDataObjectHandler</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, point, client)</p>
    </div>
    

    
  
    <div class="desc"><p>point - instance of Point, RemoteFeed or RemoteControl or a valid GUID
client - instance of IOT.Client</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.__init__', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.__init__" class="source">
    <pre><code>def __init__(self, point, client):
    """point - instance of Point, RemoteFeed or RemoteControl or a valid GUID
       client - instance of IOT.Client
    """
    # remote => use describe, non-remote => use point value listing
    if isinstance(point, Point):
        self.__remote = False
        self.__point = point
    elif isinstance(point, RemotePoint):
        self.__point = point.guid
        self.__remote = True
    else:
        self.__point = Validation.guid_check_convert(point)
        self.__remote = True
    self.__lock = Lock()
    self.__client = client
    # flag to prevent repeated fetching of value metadata
    self.__last_parse_ok = True
    self.__value_templates = None
    self.__filter = None
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.get_template">
    <p>def <span class="ident">get_template</span>(</p><p>self, data=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Get new template which represents the values of this point in a
<a href="./Point.m.html#IoticAgent.IOT.Point.PointDataObject">PointDataObject</a>. If data is set (to a dictionary), use
this to populate the created template.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.get_template', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper.PointDataObjectHandler.get_template" class="source">
    <pre><code>def get_template(self, data=None):  # noqa (complexity)
    """Get new template which represents the values of this point in a
    [PointDataObject](./Point.m.html#IoticAgent.IOT.Point.PointDataObject). If data is set (to a dictionary), use
    this to populate the created template."""
    with self.__lock:
        if self.__value_templates is None and self.__last_parse_ok:
            try:
                self.__refresh()
            except RefreshException:
                # Point has no (useable) values - don't try to refetch again
                self.__last_parse_ok = False
                raise
        if self.__value_templates is None:
            raise ValueError('Point has no values')
        if data is None:
            template = PointDataObject(self.__value_templates, self.__filter)
        else:
            while True:
                try:
                    template = PointDataObject._from_dict(self.__value_templates, self.__filter, data)
                except:
                    # parsing has failed for first time since refresh so try again
                    if self.__last_parse_ok:
                        logger.debug('Failed to parse data from for point %s, refreshing', self.__point)
                        self.__last_parse_ok = False
                        try:
                            self.__refresh()
                        except RefreshException:
                            break
                    else:
                        raise
                else:
                    self.__last_parse_ok = True
                    break
        return template
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="IoticAgent.IOT.PointValueHelper.RefreshException" class="name">class <span class="ident">RefreshException</span></p>
      
  
    <div class="desc"><p>Raised by __refresh() to indicate metadata unsuitable for template usage.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper.RefreshException', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper.RefreshException" class="source">
    <pre><code>class RefreshException(Exception):
    """Raised by __refresh() to indicate metadata unsuitable for template usage."""
    pass
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#IoticAgent.IOT.PointValueHelper.RefreshException">RefreshException</a></li>
          <li>builtins.Exception</li>
          <li>builtins.BaseException</li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="IoticAgent.IOT.PointValueHelper.RefreshException.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="IoticAgent.IOT.PointValueHelper.Value" class="name">class <span class="ident">Value</span></p>
      
  
    <div class="desc"><p>Represent data and metadata for a single value. NOT thread safe.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper.Value', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper.Value" class="source">
    <pre><code>class Value(object):
    """Represent data and metadata for a single value. NOT thread safe."""

    __slots__ = tuple(private_names_for('Value', ('__label', '__type', '__unit', '__description', '__unset',
                                                  '__value')))

    def __init__(self, label, type_, unit=None, description=None):
        self.__label = label
        self.__type = type_
        self.__unit = unit
        self.__description = description
        self.__unset = True
        self.__value = None

    @property
    def unset(self):
        """Whether this value instances has had data assigned to it"""
        return self.__unset

    @property
    def label(self):
        """Label for this value"""
        return self.__label

    @property
    def type_(self):
        """Value type, e.g. one of IoticAgent.Datatypes"""
        return self.__type

    @property
    def unit(self):
        """Value unit, e.g. one of IoticAgent.Units"""
        return self.__unit

    @property
    def description(self):
        """Human-readable description of this value"""
        return self.__description

    @property
    def value(self):
        """Data for this value. Returns None if it hasn't been set. To distinguish between None and
        and unset, check the `unset` property."""
        return self.__value

    @value.setter
    def value(self, value):
        self.__unset = False
        self.__value = value

    @value.deleter
    def value(self):
        self.__unset = True
        self.__value = None

    def copy(self):
        return Value(self.__label, self.__type, self.__unit, self.__description)
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#IoticAgent.IOT.PointValueHelper.Value">Value</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="IoticAgent.IOT.PointValueHelper.Value.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, label, type_, unit=None, description=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper.Value.__init__', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper.Value.__init__" class="source">
    <pre><code>def __init__(self, label, type_, unit=None, description=None):
    self.__label = label
    self.__type = type_
    self.__unit = unit
    self.__description = description
    self.__unset = True
    self.__value = None
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="IoticAgent.IOT.PointValueHelper.Value.copy">
    <p>def <span class="ident">copy</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-IoticAgent.IOT.PointValueHelper.Value.copy', this);">Show source &equiv;</a></p>
  <div id="source-IoticAgent.IOT.PointValueHelper.Value.copy" class="source">
    <pre><code>def copy(self):
    return Value(self.__label, self.__type, self.__unit, self.__description)
</code></pre>
  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="IoticAgent.IOT.PointValueHelper.Value.description" class="name">var <span class="ident">description</span></p>
            

            
  
    <div class="desc"><p>Human-readable description of this value</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="IoticAgent.IOT.PointValueHelper.Value.label" class="name">var <span class="ident">label</span></p>
            

            
  
    <div class="desc"><p>Label for this value</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="IoticAgent.IOT.PointValueHelper.Value.type_" class="name">var <span class="ident">type_</span></p>
            

            
  
    <div class="desc"><p>Value type, e.g. one of IoticAgent.Datatypes</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="IoticAgent.IOT.PointValueHelper.Value.unit" class="name">var <span class="ident">unit</span></p>
            

            
  
    <div class="desc"><p>Value unit, e.g. one of IoticAgent.Units</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="IoticAgent.IOT.PointValueHelper.Value.unset" class="name">var <span class="ident">unset</span></p>
            

            
  
    <div class="desc"><p>Whether this value instances has had data assigned to it</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="IoticAgent.IOT.PointValueHelper.Value.value" class="name">var <span class="ident">value</span></p>
            

            
  
    <div class="desc"><p>Data for this value. Returns None if it hasn't been set. To distinguish between None and
and unset, check the <code>unset</code> property.</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
